(self.webpackChunk_redhat_cloud_services_access_requests_frontend=self.webpackChunk_redhat_cloud_services_access_requests_frontend||[]).push([[871],{6733:(e,t,n)=>{"use strict";t.Z1={name:"CubesIcon",height:512,width:512,svgPath:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z",yOffset:0,xOffset:0},t.TF=n(5183).createIcon(t.Z1),t.ZP=t.TF},4046:(e,t,n)=>{"use strict";t.MU={name:"HelpIcon",height:1024,width:1024,svgPath:"M521.3,576 C627.5,576 713.7,502 713.7,413.7 C713.7,325.4 627.6,253.6 521.3,253.6 C366,253.6 334.5,337.7 329.2,407.2 C329.2,414.3 335.2,416 343.5,416 L445,416 C450.5,416 458,415.5 460.8,406.5 C460.8,362.6 582.9,357.1 582.9,413.6 C582.9,441.9 556.2,470.9 521.3,473 C486.4,475.1 447.3,479.8 447.3,521.7 L447.3,553.8 C447.3,570.8 456.1,576 472,576 C487.9,576 521.3,576 521.3,576 M575.3,751.3 L575.3,655.3 C575.313862,651.055109 573.620137,646.982962 570.6,644 C567.638831,640.947672 563.552355,639.247987 559.3,639.29884 L463.3,639.29884 C459.055109,639.286138 454.982962,640.979863 452,644 C448.947672,646.961169 447.247987,651.047645 447.29884,655.3 L447.29884,751.3 C447.286138,755.544891 448.979863,759.617038 452,762.6 C454.961169,765.652328 459.047645,767.352013 463.3,767.30116 L559.3,767.30116 C563.544891,767.313862 567.617038,765.620137 570.6,762.6 C573.659349,759.643612 575.360354,755.553963 575.3,751.3 M512,896 C300.2,896 128,723.9 128,512 C128,300.3 300.2,128 512,128 C723.8,128 896,300.2 896,512 C896,723.8 723.7,896 512,896 M512.1,0 C229.7,0 0,229.8 0,512 C0,794.2 229.8,1024 512.1,1024 C794.4,1024 1024,794.3 1024,512 C1024,229.7 794.4,0 512.1,0",yOffset:0,xOffset:0},t.by=n(5183).createIcon(t.MU),t.ZP=t.by},3871:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Z});var a=n(3297),r=n.n(a),l=n(5399),c=n(3004),o=n(7154),i=n.n(o),u=n(319),s=n.n(u),m=n(3038),d=n.n(m),p=n(6401),f=n(9971),E=n(3215),h=function(e){var t=e.requestId,n=e.onClose,a=r().useState(!1),l=d()(a,2),o=l[0],i=l[1],u=(0,f.useDispatch)();return r().createElement(c.Modal,{title:"Cancel request?",isOpen:!0,variant:"small",onClose:function(){return n(!1)},actions:[r().createElement(c.Button,{key:"confirm",variant:"danger",onClick:function(){i(!0),fetch("".concat("/api/rbac/v1","/cross-account-requests/?uuid=").concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled"})}).then((function(e){return e.json()})).then((function(e){if(e.errors&&e.errors.length>0)throw Error(e.errors.map((function(e){return e.detail})).join("\n"));u((0,E.wN)({variant:"success",title:"Request cancelled successfully",dismissable:!0})),i(!1),n(!0)})).catch((function(e){u((0,E.wN)({variant:"danger",title:"There was an error cancelling your request",description:e.message,dismissable:!0})),i(!1)}))}},"Yes, cancel"),r().createElement(c.Button,{key:"cancel",variant:"link",onClick:function(){return n(!1)}},"No, keep")]},"Request ",r().createElement("b",null,t)," will be withdrawn.",o&&r().createElement(c.Spinner,{size:"lg"}))};h.displayName="CancelRequestModal";const b=h;var g=n(4046),y=n(164),v=n(4432),C=n(1643),S="Customers will be able to see this information as part of your request",w={"first name":S,"last name":S,"account number":"This is the account number that you would like to receive read access to","access duration":"This is the time frame you would like to be granted read access to accounts"},T=function(e){return r().createElement(c.Popover,{bodyContent:r().createElement("p",null,w[e])},r().createElement("button",{type:"button","aria-label":"More info for ".concat(e),onClick:function(e){return e.preventDefault()},"aria-describedby":"form-name",className:"pf-c-form__group-label-help"},r().createElement(g.ZP,{noVerticalAlign:!0})))},q=new Date;q.setDate(q.getDate()-1);var k=function(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})},I=function(e){var t=e.split("/");if(3!==t.length)return new Date;var n=t[0].padStart(2,"0"),a=t[1].padStart(2,"0"),r=t[2].padStart(4,"0");return new Date("".concat(r,"-").concat(n,"-").concat(a,"T00:00:00"))},P=function(e){var t=e.user,n=void 0===t?{}:t,a=e.targetAccount,l=e.setTargetAccount,o=e.start,i=e.setStart,u=e.end,s=e.setEnd,m=e.disableAccount,p=e.isLoading,f=r().useState(),E=d()(f,2),h=E[0],b=E[1];return r().createElement(c.Form,{onSubmit:function(e){return e.preventDefault()},isDisabled:p},r().createElement(c.Title,{headingLevel:"h2"},"Request details"),r().createElement(c.Split,{hasGutter:!0},r().createElement(c.SplitItem,{isFilled:!0},r().createElement(c.FormGroup,{label:"First name",labelIcon:T("first name")},r().createElement(c.TextInput,{id:"first-name",value:n.first_name,isDisabled:!0}))),r().createElement(c.SplitItem,{isFilled:!0},r().createElement(c.FormGroup,{label:"Last name",labelIcon:T("last name")},r().createElement(c.TextInput,{id:"last-name",value:n.last_name,isDisabled:!0})))),r().createElement(c.FormGroup,{label:"Account number",isRequired:!0,labelIcon:T("account number"),helperText:"Enter the account number you would like access to"},r().createElement(c.TextInput,{id:"account-number",value:a,onChange:function(e){return l(e)},isRequired:!0,placeholder:"865392",isDisabled:m})),r().createElement(c.FormGroup,{label:"Access duration",isRequired:!0,labelIcon:T("access duration")},r().createElement(c.Split,null,r().createElement(c.SplitItem,null,r().createElement(c.DatePicker,{width:"300px","aria-label":"Start date",value:o,dateFormat:k,dateParse:I,placeholder:"mm/dd/yyyy",onChange:function(e,t){b(new Date(t)),i(e),(0,v.qb)(t)?(t.setDate(t.getDate()+7),s(k(t))):s("")},validators:[function(e){return(0,v.qb)(e)&&e<q?"Start date must be today or later":""}]})),r().createElement(c.SplitItem,{style:{padding:"6px 12px 0 12px"}},"to"),r().createElement(c.SplitItem,null,r().createElement(c.DatePicker,{width:"300px","aria-label":"End date",value:u,dateFormat:k,dateParse:I,placeholder:"mm/dd/yyyy",onChange:function(e){return s(e)},validators:[function(e){if((0,v.qb)(h)){if(h>e)return s(""),"End date must be after from date";var t=new Date(h);if(t.setFullYear(t.getFullYear()+1),e>t)return s(""),"Access duration cannot be longer than one year"}return""}],rangeStart:o})))))},x={paddingBottom:"16px"},_=function(e){var t=e.targetAccount,n=e.start,a=e.end,l=e.roles,o=e.isLoading;return r().createElement(r().Fragment,null,r().createElement(c.Title,{headingLevel:"h2",style:x},"Review details"),r().createElement("table",null,r().createElement("tr",null,r().createElement("td",{style:x},r().createElement("b",null,"Account number")),r().createElement("td",{style:x},t)),r().createElement("tr",null,r().createElement("td",{style:{paddingRight:"32px"}},r().createElement("b",null,"Access duration")),r().createElement("td",null)),r().createElement("tr",null,r().createElement("td",null,"From"),r().createElement("td",null,n)),r().createElement("tr",null,r().createElement("td",{style:x},"To"),r().createElement("td",{style:x},a)),r().createElement("tr",null,r().createElement("td",null,r().createElement("b",null,"Roles")),r().createElement("td",null,l[0])),l.slice(1).map((function(e){return r().createElement("tr",{key:e},r().createElement("td",null),r().createElement("td",null,e))}))),o&&r().createElement(c.Spinner,null))},D=function(e){var t=e.row,n=void 0===t?[]:t,a=e.variant,l=e.onClose,o=r().useState(!0),i=d()(o,2),u=i[0],s=i[1],m=r().useState(),p=d()(m,2),h=p[0],b=p[1],g=r().useState(),v=d()(g,2),S=v[0],w=v[1],T=r().useState("renew"===a?k(new Date):void 0),q=d()(T,2),I=q[0],x=q[1],D=r().useState(),L=d()(D,2),R=L[0],A=L[1],N=r().useState([]),F=d()(N,2),B=F[0],M=F[1],z=(0,f.useDispatch)(),O="edit"===a;r().useEffect((function(){var e=window.insights.chrome.auth.getUser(),t=O?fetch("".concat("/api/rbac/v1","/cross-account-requests/").concat(n[0],"/")).then((function(e){return e.json()})):new Promise((function(e){return e(!0)}));Promise.all([e,t]).then((function(e){var t=d()(e,2),a=t[0],r=t[1];if(!(a&&a.identity&&a.identity.user))throw Error("Couldn't get current user. Make sure you're logged in");if(b(a.identity.user),O){if(!r)throw r.errors?Error(r.errors.map((function(e){return e.detail})).join("\n")):Error("Could not fetch details for request ".concat(n[0]));w(r.target_account),x(r.start_date),A(r.end_date),M(r.roles.map((function(e){return e.display_name})))}s(!1)})).catch((function(e){z((0,E.wN)({variant:"danger",title:"Could not load access request",description:e.message,dismissable:!0}))}))}),[]);var Z=[S,I,R].every(Boolean),j=B.length>0,G=[{name:"Request details",component:r().createElement(P,{user:h,targetAccount:S,setTargetAccount:w,start:I,setStart:x,end:R,setEnd:A,disableAccount:"edit"===a||"renew"===a,isLoading:u}),enableNext:Z},{name:"Select roles",component:r().createElement(C.Z,{roles:B,setRoles:M}),enableNext:j,canJumpTo:Z},{name:"Review details",component:r().createElement(_,{targetAccount:S,start:I,end:R,roles:B,isLoading:u}),canJumpTo:Z&&j,enableNext:!u,nextButtonText:"Finish"}],U="".concat(a,"-request"),V="".concat(a," request");return r().createElement(c.Modal,{variant:"large",style:{height:"900px"},showClose:!1,hasNoBodyWrapper:!0,isOpen:!0,onClose:function(){return l(!1)},"aria-describedby":V,"aria-labelledby":U},r().createElement(c.Wizard,{titleId:U,descriptionId:V,title:(0,y.kC)(a)+" request",steps:G,onClose:function(){return l(!1)},onSave:function(){s(!0);var e={target_account:S,start_date:I,end_date:R,roles:B};fetch("".concat("/api/rbac/v1","/cross-account-requests/").concat(O?"?uuid=".concat(n[0]):""),{method:O?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){if(e.errors&&e.errors.length>0)throw Error(e.errors[0].detail);z((0,E.wN)({variant:"success",title:"".concat((0,y.kC)(a),"d access request"),description:e.request_id,dismissable:!0})),l(!0)})).catch((function(e){z((0,E.wN)({variant:"danger",title:"Could not ".concat(a," access request"),description:e.message,dismissable:!0})),s(!1)}))}}))};D.displayName="EditRequestModal";const L=D;var R=n(8794),A=n(8755),N=n(6733),F=n(6710),B=["pending","approved","denied","cancelled","expired"];function M(e,t){var n=e[5],a=[];return"pending"===n?(a.push({title:"Edit",onClick:function(){return t({type:"edit",row:e})}}),a.push({title:"Cancel",onClick:function(){return t({type:"cancel",row:e})}})):"expired"===n&&a.push({title:"Renew",onClick:function(){return t({type:"renew",row:e})}}),{items:a,disable:0===a.length}}var z=function(){var e=["Request ID","Account number","Start date","End date","Created","Status"],t=r().useState(4),n=d()(t,2),a=n[0],o=n[1],u=r().useState("desc"),m=d()(u,2),h=m[0],g=m[1],v=function(e,t,n){o(t),g(n)},C=r().useState(1),S=d()(C,2),w=S[0],T=S[1],q=r().useState(10),k=d()(q,2),I=k[0],P=k[1],x=function(e){var t=e.id;return r().createElement(c.Pagination,{itemCount:we.length,perPage:I,page:w,onSetPage:function(e,t){return T(t)},id:"access-requests-table-pagination-"+t,variant:t,onPerPageSelect:function(e,t){return P(t)}})},_=r().useState(!1),D=d()(_,2),z=D[0],O=D[1],Z=r().useState(e[0]),j=d()(Z,2),G=j[0],U=j[1],V=r().useState(!1),J=d()(V,2),H=J[0],Y=J[1],W=r().useState([]),Q=d()(W,2),K=Q[0],X=Q[1],$=r().useState(""),ee=d()($,2),te=ee[0],ne=ee[1],ae=r().useState([]),re=d()(ae,2),le=re[0],ce=re[1],oe=r().useState(""),ie=d()(oe,2),ue=ie[0],se=ie[1],me=r().useState([]),de=d()(me,2),pe=de[0],fe=de[1],Ee="filter-status",he="Filter by status",be=r().useState(!0),ge=d()(be,2),ye=ge[0],ve=ge[1],Ce=r().useState([]),Se=d()(Ce,2),we=Se[0],Te=Se[1],qe=(0,f.useDispatch)(),ke=function(){ve(!0);var t=new URL("".concat(window.location.origin).concat("/api/rbac/v1","/cross-account-requests/"));t.searchParams.append("query_by","user_id"),t.searchParams.append("offset",(w-1)*I),t.searchParams.append("limit",I),K.length>0&&t.searchParams.append("status",K.join(",")),t.searchParams.append("sort_by",e[a].toLowerCase()),t.searchParams.append("sort_direction",h),fetch(t.href).then((function(e){return e.json()})).then((function(e){Te(e.data.map((function(e){return[e.request_id,e.target_account,e.start_date,e.end_date,e.created,e.status]}))),ve(!1)})).catch((function(e){ve(!1),qe((0,E.wN)({variant:"danger",title:"Could not list access requests",description:e.message}))}))};r().useEffect((function(){ke()}),[K,a,h,I,w]);var Ie=r().useState({type:null}),Pe=d()(Ie,2),xe=Pe[0],_e=Pe[1],De=function(e){_e({type:null}),e&&(console.log("isChanged",e),ke())},Le=r().createElement(r().Fragment,null,"cancel"===xe.type&&r().createElement(b,{requestId:xe.row[0],onClose:De}),["edit","renew","create"].includes(xe.type)&&r().createElement(L,{variant:xe.type,row:xe.row,onClose:De})),Re=r().createElement(c.Button,{variant:"primary",onClick:function(){return _e({type:"create"})}},"Create request");if(0===we.length)return r().createElement(c.Bullseye,null,ye?r().createElement(c.Spinner,{size:"xl"}):r().createElement(c.EmptyState,null,r().createElement(c.EmptyStateIcon,{icon:N.ZP}),r().createElement(c.Title,{headingLevel:"h3",size:"lg"},"Empty state"),r().createElement(c.EmptyStateBody,null,"I'm empty"),Re),Le);var Ae=r().createElement(c.Toolbar,{id:"access-requests-table-toolbar"},r().createElement(c.ToolbarContent,null,r().createElement(c.ToolbarItem,null,r().createElement(c.InputGroup,null,r().createElement(c.Dropdown,{isOpen:z,onSelect:function(e){O(!1),U(e.target.value),Y(!1)},toggle:r().createElement(c.DropdownToggle,{onToggle:function(e){return O(e)}},r().createElement(A.ZP,null)," ",G),dropdownItems:[0,1,5].map((function(t){return e[t]})).map((function(e){return r().createElement(c.DropdownItem,{key:e,value:e,component:"button"},(0,y.kC)(e))}))}),"Status"===G&&r().createElement(r().Fragment,null,r().createElement("span",{id:Ee,hidden:!0},he),r().createElement(c.Select,{"aria-labelledby":Ee,variant:"checkbox","aria-label":"Select statuses",onToggle:function(e){return Y(e)},onSelect:function(e,t){K.includes(t)?X(K.filter((function(e){return e!==t}))):X([].concat(s()(K),[t]))},isOpen:H,selections:Array.from(K),isCheckboxSelectionBadgeHidden:!0,placeholderText:he},B.map((function(e){return r().createElement(c.SelectOption,{key:e,value:e},(0,y.kC)(e))})))),"Request ID"===G&&r().createElement("form",{style:{display:"flex"},onSubmit:function(e){e.preventDefault(),ce(le.concat(te)),ne("")}},r().createElement(c.TextInput,{name:"idSearch",id:"idSearch",type:"search","aria-label":"Request id search input",value:te,onChange:function(e){return ne(e)}}),r().createElement(c.Button,{variant:"control",type:"submit","aria-label":"Search button for request id input"},r().createElement(R.ZP,null))),"Account number"===G&&r().createElement("form",{style:{display:"flex"},onSubmit:function(e){e.preventDefault(),fe(pe.concat(ue)),se("")}},r().createElement(c.TextInput,{name:"idSearch",id:"idSearch",type:"search","aria-label":"Account number search input",value:ue,onChange:function(e){return se(e)}}),r().createElement(c.Button,{variant:"control",type:"submit","aria-label":"Search button for account number input"},r().createElement(R.ZP,null))))),r().createElement(c.ToolbarItem,null,Re),r().createElement(c.ToolbarItem,{variant:"pagination",align:{default:"alignRight"}},r().createElement(x,{id:"top"}))),r().createElement(c.ToolbarContent,null,r().createElement(c.ChipGroup,{categoryName:"Status"},K.map((function(e){return r().createElement(c.Chip,{key:e,onClick:function(){return X(K.filter((function(t){return t!==e})))}},e)}))),r().createElement(c.ChipGroup,{categoryName:"Request ID"},le.map((function(e){return r().createElement(c.Chip,{key:e,onClick:function(){return ce(le.filter((function(t){return t!==e})))}},e)}))),r().createElement(c.ChipGroup,{categoryName:"Account number"},pe.map((function(e){return r().createElement(c.Chip,{key:e,onClick:function(){return fe(pe.filter((function(t){return t!==e})))}},e)}))),(K.length>0||le.length>0||pe.length>0)&&r().createElement(c.Button,{variant:"link",onClick:function(){X([]),ce([]),fe([])}},"Clear filters"))),Ne=r().createElement(p.TableComposable,{"aria-label":"Access requests table",variant:"compact"},r().createElement(p.Thead,null,r().createElement(p.Tr,null,e.map((function(e,t){return r().createElement(p.Th,{key:t,sort:{sortBy:{index:a,direction:h},onSort:v,columnIndex:t},width:0===t?30:15},e)})),r().createElement(p.Th,null))),r().createElement(p.Tbody,null,ye?r().createElement(p.Tr,{colSpan:6},r().createElement(c.Bullseye,null,r().createElement(c.Spinner,{size:"xl"}))):we.map((function(t,n){return r().createElement(p.Tr,{key:n},r().createElement(p.Td,{dataLabel:e[0]},r().createElement(l.Link,{to:"/".concat(t[0])},t[0])),r().createElement(p.Td,{dataLabel:e[1]},t[1]),r().createElement(p.Td,{dataLabel:e[2]},t[2]),r().createElement(p.Td,{dataLabel:e[3]},t[3]),r().createElement(p.Td,{dataLabel:e[4]},t[4]),r().createElement(p.Td,{dataLabel:e[5]},r().createElement(c.Label,i()({},(0,F.Q)(t[5]),{render:function(e){var n=e.content,a=e.className;return r().createElement("button",{className:a,onClick:function(){return X([].concat(s()(K.filter((function(e){return e!==t[5]}))),[t[5]]))}},n)}}),(0,y.kC)(t[5]))),r().createElement(p.Td,{actions:M(t,_e)}))}))));return r().createElement(r().Fragment,null,Ae,Ne,r().createElement(x,{id:"bottom"}),Le)};z.displayName="AccessRequestsTable";const O=z,Z=(0,l.withRouter)((function(){return r().createElement(r().Fragment,null,r().createElement(c.PageSection,{variant:"light"},r().createElement(c.Title,{headingLevel:"h1",className:"pf-u-pb-sm"},"Access Requests"),r().createElement("p",null,"Below is a list of all submitted requests for read only account access.")),r().createElement(c.PageSection,{padding:{default:"noPadding"}},r().createElement(O,null)))}))}}]);
//# sourceMappingURL=871.a15ca9bd70a762f7e89d.js.map