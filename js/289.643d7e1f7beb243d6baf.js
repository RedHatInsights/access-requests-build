(self.webpackChunkaccessRequests=self.webpackChunkaccessRequests||[]).push([[289],{17733:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var a=n(29439),r=n(92950),l=n.n(r),o=n(6848),c=n(28216),i=n(83215),s=n(45697),u=n.n(s),m=n(24874),d=function(e){var t=e.requestId,n=e.onClose,r=l().useState(!1),s=(0,a.Z)(r,2),u=s[0],d=s[1],p=(0,c.I0)();return l().createElement(o.Modal,{title:"Cancel request?",isOpen:!0,variant:"small",onClose:function(){return n(!1)},actions:[l().createElement(o.Button,{key:"confirm",variant:"danger",onClick:function(){d(!0),m.Z.patch("".concat("/api/rbac/v1","/cross-account-requests/").concat(t,"/"),{status:"cancelled"},{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(e){if(e.errors&&e.errors.length>0)throw Error(e.errors.map((function(e){return e.detail})).join("\n"));p((0,i.wN)({variant:"success",title:"Request cancelled successfully"})),d(!1),n(!0)})).catch((function(e){p((0,i.wN)({variant:"danger",title:"There was an error cancelling your request",description:e.message})),d(!1),n(!0)}))}},"Yes, cancel"),l().createElement(o.Button,{key:"cancel",variant:"link",onClick:function(){return n(!1)}},"No, keep")]},"Request ",l().createElement("b",null,t)," will be withdrawn.",u&&l().createElement(o.Spinner,{size:"lg"}))};d.propTypes={requestId:u().string,onClose:u().func};const p=d},479:(e,t,n)=>{"use strict";n.d(t,{Z:()=>V});var a=n(4942),r=n(29439),l=n(87462),o=n(92950),c=n.n(o),i=n(45697),s=n.n(i),u=n(28216),m=n(83215),d=n(6848),p=n(84564),f=n(68395),E=n(67850),y=n(75483),g=n(99875),v=n(48880),h=n(69965),b=n(64124),S=n(96354),T=n(84213),w=function(e){var t=e.headerContent,n=void 0===t?null:t,a=e.bodyContent,r=void 0===a?null:a,l=e.field,o=void 0===l?"input":l;return c().createElement(d.Popover,{headerContent:n,bodyContent:r},c().createElement("button",{type:"button","aria-label":"More info for ".concat(o),onClick:function(e){return e.preventDefault()},"aria-describedby":"form-name",className:"pf-c-form__group-label-help"},c().createElement(T.ZP,{noVerticalAlign:!0})))};w.propTypes={headerContent:s().element,bodyContent:s().element,field:s().string};const k=w;var C="account-number",I="org-id",Z="start",x="end",D="selected-roles",O=function(e){var t=(0,g.Z)(e).input,n=(0,v.default)().getState().values,a=(0,o.useState)(n[D]||[]),l=(0,r.Z)(a,2),i=l[0],s=l[1];return(0,o.useEffect)((function(){t.onChange(i)}),[i]),c().createElement(d.FormGroup,{fieldId:"select-role"},c().createElement(h.Z,{roles:i,setRoles:s}))};O.propTypes={selectedRoles:s().array,setSelectedRoles:s().func,title:s().string,description:s().string};const q=O;var P=function(){var e,t,n=(0,v.default)().getState().values;return c().createElement(c().Fragment,null,c().createElement(d.Stack,{className:"accessRequests"},c().createElement(d.StackItem,{className:"pf-u-mb-md"},c().createElement(d.Grid,null,c().createElement(d.GridItem,{sm:12,md:2},c().createElement(d.Text,{component:d.TextVariants.h4,className:"access-requests-bold-text"},"Account number")),c().createElement(d.GridItem,{sm:12,md:10},c().createElement(d.Text,{component:d.TextVariants.p},n[C])))),c().createElement(d.StackItem,null,c().createElement(d.Grid,null,c().createElement(d.GridItem,{sm:12,md:2},c().createElement(d.Text,{component:d.TextVariants.h4,className:"access-requests-bold-text"},"Access duration")))),c().createElement(d.StackItem,null,c().createElement(d.Grid,null,c().createElement(d.GridItem,{sm:12,md:2},c().createElement(d.Text,{component:d.TextVariants.h4},"From")),c().createElement(d.GridItem,{sm:12,md:10},c().createElement(d.Text,{component:d.TextVariants.p},n[Z])))),c().createElement(d.StackItem,{className:"pf-u-mb-md"},c().createElement(d.Grid,null,c().createElement(d.GridItem,{sm:12,md:2},c().createElement(d.Text,{component:d.TextVariants.h4},"To")),c().createElement(d.GridItem,{sm:12,md:10},c().createElement(d.Text,{component:d.TextVariants.p},n[x])))),c().createElement(d.StackItem,null,c().createElement(d.Grid,null,c().createElement(d.GridItem,{sm:12,md:2},c().createElement(d.Text,{component:d.TextVariants.h4,className:"access-requests-bold-text"},"Roles")),c().createElement(d.GridItem,{sm:12,md:10},c().createElement(d.Text,{component:d.TextVariants.p},null===(e=n[D])||void 0===e?void 0:e[0])))),null===(t=n[D])||void 0===t?void 0:t.slice(1).map((function(e){return c().createElement(d.StackItem,{key:e},c().createElement(d.Grid,null,c().createElement(d.GridItem,{sm:12,md:2},c().createElement(d.Text,{component:d.TextVariants.h4})),c().createElement(d.GridItem,{sm:12,md:10},c().createElement(d.Text,{component:d.TextVariants.p},e))))}))))};P.propTypes={targetAccount:s().any,start:s().any,end:s().any,roles:s().any,isLoading:s().any,error:s().any,onClose:s().any};const R=P;var F=n(24874);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j="Invalid Account number",A=function(e){return c().createElement(E.ZP,(0,l.Z)({},e,{showFormControls:!1}))},B={"set-name":function(){var e=(0,v.default)().getState,t=c().createElement("p",null,"Customers will be able to see this information as part of your request");return c().createElement(d.Split,{hasGutter:!0},c().createElement(d.SplitItem,{isFilled:!0},c().createElement(d.FormGroup,{label:"First name",name:"first-name",labelIcon:c().createElement(k,{bodyContent:t,field:"first name"})},c().createElement(d.TextInput,{id:"first-name",value:e().values["first-name"],isDisabled:!0}))),c().createElement(d.SplitItem,{isFilled:!0},c().createElement(d.FormGroup,{label:"Last name",name:"last-name",labelIcon:c().createElement(k,{bodyContent:t,field:"last name"})},c().createElement(d.TextInput,{id:"last-name",value:e().values["last-name"],isDisabled:!0}))))},"access-duration":function(){var e=(0,v.default)(),t=e.getState().values,n=c().useState(),a=(0,r.Z)(n,2),l=a[0],o=a[1],i=c().useState(),s=(0,r.Z)(i,2),u=s[0],m=s[1],p=c().useState(),f=(0,r.Z)(p,2),E=f[0],y=f[1],g=new Date;g.setDate(g.getDate()-1);var h=new Date;h.setDate(h.getDate()+60);var b=function(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})},S=function(e){return/^([0]?[1-9]|[1][0-2])\/([0]?[1-9]|[1|2][0-9]|[3][0|1])\/([0-9]{4})$/.test(e)},T=function(e){var t=e.split("/");if(S(e)){var n=t[0].padStart(2,"0"),a=t[1].padStart(2,"0"),r=t[2].padStart(4,"0");return new Date("".concat(r,"-").concat(n,"-").concat(a,"T00:00:00"))}},w=function(e){if((0,d.isValidDate)(e)){if(e<g){var t="Start date must be today or later";return y(t),t}if(e>h){var n="Start date must be within 60 days of today";return y(n),n}}return y(),""},C=function(e){if(m(),(0,d.isValidDate)(l)){if(l>e){var t="End date must be after start date";return m(t),t}var n=new Date(l);n.setFullYear(n.getFullYear()+1);var a="Access duration may not be longer than one year";return e>n&&m(a),e>n?a:""}return m(),""},I=function(t,n,a){o(a?new Date(a):void 0),e.change(Z,S(n)?n:""),(0,d.isValidDate)(a)&&!w(a)&&(a.setDate(a.getDate()+7),e.change(x,b(a)),m())},D=function(t,n,a){C(a)||!S(n)?e.change(x,""):(e.change(x,n),w(l)&&e.change(Z,"")&&y())};return c().createElement(d.FormGroup,{label:"Access duration",isRequired:!0,labelIcon:c().createElement(k,{bodyContent:c().createElement("div",null,"This is the time frame you would like to be granted read access to accounts."),field:"access duration"})},c().createElement(d.Split,{hasGutter:!0},c().createElement(d.SplitItem,null,c().createElement(d.DatePicker,{"aria-label":"Start date",placeholder:"mm/dd/yyyy",value:t[Z],dateFormat:b,dateParse:T,onChange:I,validators:[w],inputProps:{onBlur:function(e){return e.target.value,I()},validated:""===t[Z]||t[Z]&&!S(t[Z])?d.ValidatedOptions.error:d.ValidatedOptions.default}}),E||""===t[Z]?c().createElement(d.HelperText,null,c().createElement(d.HelperTextItem,{variant:"error"},""===t[Z]?"Enter a valid date ":E)):null),c().createElement(d.SplitItem,{className:"pf-u-mt-sm"},"to"),c().createElement(d.SplitItem,null,c().createElement(d.DatePicker,{"aria-label":"End date",placeholder:"mm/dd/yyyy",value:t[x],dateFormat:b,dateParse:T,onChange:D,validators:[C],inputProps:{onBlur:function(e){return e.target.value,D()},validated:""===t[x]||t[x]&&!S(t[x])?d.ValidatedOptions.error:d.ValidatedOptions.default}}),u||""===t[x]?c().createElement(d.HelperText,null,c().createElement(d.HelperTextItem,{variant:"error"},""===t[Z]?"Enter a valid date ":u)):null)))},"select-roles":q,"review-details":R},G=function(e){var t=e.requestId,n=e.variant,l=e.onClose,i=(0,u.I0)(),s="edit"===n,E=(0,o.useRef)(function(e,t){return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,className:"accessRequests",title:"".concat((0,d.capitalize)(t)," request"),fields:[{name:"details",nextStep:"select-roles",title:"Request details",fields:[{component:"set-name",name:"name",validate:[{type:b.Z.REQUIRED}]},{component:S.Z.TEXT_FIELD,isRequired:!0,label:"Account number",isDisabled:e,placeholder:"Example, 8675309",FormGroupProps:{labelIcon:c().createElement(k,{bodyContent:c().createElement("p",null,"This is the account number that you would like to receive read access to"),field:"account number"})},helperText:"Enter the account number you would like access to",name:C,validate:[{type:"validate-account"}]},{component:S.Z.TEXT_FIELD,isRequired:!0,label:"Organization ID",placeholder:"Example, 1234567",isDisabled:e,FormGroupProps:{labelIcon:c().createElement(k,{bodyContent:c().createElement("p",null,"This is the org ID of the account that you would like to receive read access to"),field:"organization ID"})},helperText:"Enter the organization ID you would like access to",name:I,validate:[{type:"validate-org-id"}]},{name:"access-duration",component:"access-duration",label:"Access duration",isRequired:!0},{name:Z,component:S.Z.TEXT_FIELD,hideField:!0,isRequired:!0,validate:[function(e){return(null==e?void 0:e.length)>0?void 0:"Invalid start date"}]},{name:x,component:S.Z.TEXT_FIELD,hideField:!0,isRequired:!0,validate:[function(e){return(null==e?void 0:e.length)>0?void 0:"Invalid end date"}]}]},{name:"select-roles",nextStep:"review-details",title:"Select roles",StepTemplate:function(e){return e.formFields},fields:[{component:"select-roles",name:D,validate:[function(e){return(null==e?void 0:e.length)>0?void 0:"No roles selected"}]}]},{name:"review-details",title:"Review details",fields:[{component:"review-details",name:"review-details"}]}]}]}}(s,n)),g=(0,o.useState)(!1),v=(0,r.Z)(g,2),h=v[0],T=v[1],w=c().useState(),O=(0,r.Z)(w,2),q=O[0],P=O[1],R=c().useState(),_=(0,r.Z)(R,2),G=_[0],V=_[1],L=c().useState(!1),z=(0,r.Z)(L,2),M=z[0],H=z[1],U=c().useState(!1),X=(0,r.Z)(U,2),Q=X[0],Y=X[1],W=c().useState(),$=(0,r.Z)(W,2),J=$[0],K=$[1];c().useEffect((function(){H(!0);var e=insights.chrome.auth.getUser(),n=s?F.Z.get("".concat("/api/rbac/v1","/cross-account-requests/").concat(t,"/?query_by=user_id"),{headers:{Accept:"application/json"}}):new Promise((function(e){return e(!0)}));Promise.all([e,n]).then((function(e){var n=(0,r.Z)(e,2),l=n[0],o=n[1];if(!(l&&l.identity&&l.identity.user))throw Error("Couldn't get current user. Make sure you're logged in");if(K(l.identity.user),s){if(o.errors)throw Error(o.errors.map((function(e){return e.detail})).join("\n"));if(!o||!o.target_account)throw Error("Could not fetch details for request ".concat(t));var c;V((c={},(0,a.Z)(c,C,o.target_account),(0,a.Z)(c,I,o.target_org),(0,a.Z)(c,Z,o.start_date),(0,a.Z)(c,x,o.end_date),(0,a.Z)(c,D,o.roles.map((function(e){return e.display_name}))),c))}H(!1)})).catch((function(e){i((0,m.wN)({variant:"danger",title:"Could not load access request",description:e.message}))}))}),[]);var ee={"validate-account":function(){return function(e){return e&&!q?void 0:"Please enter a valid account number"}},"validate-org-id":function(){return function(e){return e&&!q?void 0:"Please enter a valid organization ID"}},"validate-duration":function(){return function(e){return(null==e?void 0:e.length)>0}}};return h?c().createElement(d.Modal,{title:"Exit request creation?",variant:"small",titleIconVariant:"warning",isOpen:!0,onClose:function(){T(!1),l(!1)},actions:[c().createElement(d.Button,{key:"confirm",variant:"primary",onClick:function(){return l(!1)}},"Exit"),c().createElement(d.Button,{key:"cancel",variant:"link",onClick:function(){return T(!1)}},"Stay")]},"All inputs will be discarded."):q||M||Q?c().createElement(d.Modal,{isOpen:!0,variant:d.ModalVariant.large,showClose:!1,className:"accessRequests",hasNoBodyWrapper:!0,"aria-describedby":"wiz-modal-description","aria-labelledby":"wiz-modal-title"},c().createElement(d.Wizard,{className:"accessRequests",title:"".concat((0,d.capitalize)(n)," request"),steps:[{name:"status",component:M?c().createElement(d.Bullseye,null,c().createElement(d.Spinner,null)):c().createElement(d.EmptyState,null,Q?c().createElement(c().Fragment,null,c().createElement(d.EmptyStateIcon,{icon:function(){return c().createElement(d.Spinner,{size:"lg"})}}),c().createElement(d.Title,{headingLevel:"h2",size:"lg"},"Submitting access request"),c().createElement(d.Button,{variant:"link",onClick:function(){return l(!0)}},"Close")):c().createElement(c().Fragment,null,c().createElement(d.EmptyStateIcon,{icon:p.ZP,color:"#C9190B"}),c().createElement(d.Title,{headingLevel:"h2",size:"lg"},q.title||"An error occured"),c().createElement(d.EmptyStateBody,null,q.description),q.title!==j&&c().createElement(d.Button,{variant:"primary",onClick:function(){return P()}},"Return to Step 1"))),isFinishedStep:!0}],onClose:function(){return l(!0)}})):c().createElement(f.Z,{schema:E.current,subscription:{values:!0},FormTemplate:A,componentMapper:N(N({},y.ZP),B),validatorMapper:ee,onSubmit:function(e){Y(!0);var a={target_account:e[C],start_date:e[Z],end_date:e[x],target_org:e[I],roles:e[D]};V(e),F.Z[s?"put":"post"]("".concat("/api/rbac/v1","/cross-account-requests/").concat(s?"/".concat(t,"/"):""),a,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(e){if(e.errors&&e.errors.length>0)throw Error(e.errors[0].detail);i((0,m.wN)({variant:"success",title:"".concat(s?"Edited":"Created"," access request"),description:e.request_id})),l(!0)})).catch((function(e){var t,a,r,l,o=e.errors,c=void 0===o?[]:o,i=/Account .* does not exist/.test((null===(t=c[0])||void 0===t?void 0:t.message)||(null===(a=c[0])||void 0===a?void 0:a.detail));P({title:i?j:"Could not ".concat(n," access request"),description:i?"Please return to Step 1: Request details and input a new account number for your request.":(null===(r=c[0])||void 0===r?void 0:r.message)||(null===(l=c[0])||void 0===l?void 0:l.detail)}),Y(!1)}))},initialValues:N(N({},G),{},{"first-name":null==J?void 0:J.first_name,"last-name":null==J?void 0:J.last_name}),onCancel:function(){return T(!0)}})};G.propTypes={requestId:s().string,variant:s().any,onClose:s().func};const V=G},69965:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var a=n(93433),r=n(29439),l=n(92950),o=n.n(l),c=n(6848),i=n(98975),s=n(38296),u=n(28216),m=n(83215),d=n(45697),p=n.n(d),f=n(24874),E=n(4942),y=n(8755),g=n(80164);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,E.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b="filter-application",S="Filter by application",T=function(e){var t=e.selectedRoles,n=e.setSelectedRoles,i=e.isChecked,s=e.appSelections,u=e.setAppSelections,m=e.columns,d=e.rows,p=e.filteredRows,f=e.pagedRows,v=e.anySelected,T=e.clearFiltersButton,w=e.perPage,k=e.nameFilter,C=e.setNameFilter,I=e.AccessRequestsPagination,Z=e.applications,x={isDropdownOpen:!1,isSelectOpen:!1,isBulkSelectOpen:!1,filterColumn:m[0]},D=(0,l.useReducer)((function(e,t){switch(t.type){case"set":return h(h({},e),{},(0,E.Z)({},t.payload.key,t.payload.value));case"reset":return x;default:throw new Error("Unknown action type: ${action.type}")}}),x),O=(0,r.Z)(D,2),q=O[0],P=O[1],R=function(e,t){P({type:"set",payload:{key:e,value:t}})},F=s.length>0||k,_=function(e,t){n(t?p.map((function(e){return e.display_name})):[])};return o().createElement(o().Fragment,null,o().createElement(c.Toolbar,{id:"access-requests-roles-table-toolbar"},o().createElement(c.ToolbarContent,null,o().createElement(c.ToolbarItem,null,o().createElement(c.Dropdown,{onSelect:function(){return R("isBulkSelectOpen",!q.isBulkSelectOpen)},position:"left",toggle:o().createElement(c.DropdownToggle,{splitButtonItems:[o().createElement(c.DropdownToggleCheckbox,{key:"a",id:"example-checkbox-2","aria-label":v?"Deselect all":"Select all",isChecked:i,onClick:function(){return _(0,!v)}})],onToggle:function(e){return R("isBulkSelectOpen",e)},isDisabled:0===d.length},0!==t.length&&o().createElement(o().Fragment,null,t.length," selected")),isOpen:q.isBulkSelectOpen,dropdownItems:[o().createElement(c.DropdownItem,{key:"0",onClick:function(){return _(0,!1)}},"Select none (0 items)"),o().createElement(c.DropdownItem,{key:"1",onClick:function(){return n(t.concat(f.map((function(e){return e.display_name}))))}},"Select page (",Math.min(f.length,w)," items)"),o().createElement(c.DropdownItem,{key:"2",onClick:function(){return _(0,!0)}},"Select all (",p.length," items)")]})),o().createElement(c.ToolbarItem,null,o().createElement(c.InputGroup,null,o().createElement(c.Dropdown,{isOpen:q.isDropdownOpen,onSelect:function(e){R("isDropdownOpen",!1),R("isSelectOpen",!1),R("filterColumn",e.target.value)},toggle:o().createElement(c.DropdownToggle,{onToggle:function(e){return R("isDropdownOpen",e)}},o().createElement(y.ZP,null)," ",q.filterColumn),dropdownItems:["Role name","Application"].map((function(e){return o().createElement(c.DropdownItem,{key:e,value:e,component:"button"},(0,g.kC)(e))}))}),"Application"===q.filterColumn?o().createElement(o().Fragment,null,o().createElement("span",{id:b,hidden:!0},S),o().createElement(c.Select,{"aria-labelledby":b,variant:"checkbox","aria-label":"Select applications",onToggle:function(e){return R("isSelectOpen",e)},onSelect:function(e,t){s.includes(t)?u((function(e){return e.filter((function(e){return e!==t}))})):u([].concat((0,a.Z)(s),[t]))},isOpen:q.isSelectOpen,selections:s,isCheckboxSelectionBadgeHidden:!0,placeholderText:S,className:"select-toolbar"},Z.map((function(e){return o().createElement(c.SelectOption,{key:e,value:e},(0,g.kC)(e.replace(/-/g," ")))})))):o().createElement(c.TextInput,{name:"rolesSearch",id:"rolesSearch",type:"search",iconVariant:"search","aria-label":"Search input",placeholder:"Filter by role name",value:k,onChange:function(e){return C(e)}}))),o().createElement(c.ToolbarItem,{variant:"pagination",align:{default:"alignRight"}},o().createElement(I,{id:"top"}))),F&&o().createElement(c.ToolbarContent,null,k&&o().createElement(c.ChipGroup,{categoryName:"Role name"},o().createElement(c.Chip,{onClick:function(){return C("")}},k)),s.length>0&&o().createElement(c.ChipGroup,{categoryName:"Status"},s.map((function(e){return o().createElement(c.Chip,{key:e,onClick:function(){return u((function(t){return t.filter((function(t){return t!==e}))}))}},e)}))),T)))};T.propTypes={selectedRoles:p().array,setSelectedRoles:p().func,isChecked:p().bool,appSelections:p().any,setAppSelections:p().func,columns:p().array,rows:p().array,filteredRows:p().array,pagedRows:p().array,anySelected:p().bool,clearFiltersButton:p().object,perPage:p().number,nameFilter:p().string,setNameFilter:p().func,AccessRequestsPagination:p().func,applications:p().array};const w=T;var k=n(71070),C=function(e){var t=e.columns,n=e.clearFiltersButton;return o().createElement(i.Tbody,null,o().createElement(i.Tr,null,o().createElement(i.Td,{colSpan:t.length},o().createElement(c.EmptyState,{variant:"small"},o().createElement(c.EmptyStateIcon,{icon:k.ZP}),o().createElement(c.Title,{headingLevel:"h2",size:"lg"},"No matching requests found"),o().createElement(c.EmptyStateBody,null,"No results match the filter criteria. Remove all filters or clear all filters to show results."),n))))};C.propTypes={columns:p().array,clearFiltersButton:p().object};const I=C;var Z=[],x=[],D=function(e){var t=e.roles,n=e.setRoles,l=void 0===n,d=["Role name","Role description","Permissions"],E=o().useState(Array.from(Z)),y=(0,r.Z)(E,2),g=y[0],v=y[1],h=o().useState(x),b=(0,r.Z)(h,2),S=b[0],T=b[1],k=o().useState([]),C=(0,r.Z)(k,2),D=C[0],O=C[1];o().useEffect((function(){0!==Z.length&&0!==x.length||f.Z.get("".concat("/api/rbac/v1","/roles/?system=true&limit=9999&order_by=display_name&add_fields=groups_in_count"),{headers:{Accept:"application/json"}}).then((function(e){var t=e.data;t.forEach((function(e){e.isExpanded=!1,e.permissions=e.accessCount})),Z=t.map((function(e){return Object.assign({},e)})),v(t);var n=Array.from(t.map((function(e){return e.applications})).flat().reduce((function(e,t){return e.add(t),e}),new Set)).sort();x=n,T(n)})).catch((function(e){return se((0,m.wN)({variant:"danger",title:"Could not fetch roles list",description:e.message}))}))}),[]);var q=o().useState("name"),P=(0,r.Z)(q,2),R=P[0],F=P[1],_=o().useState("asc"),N=(0,r.Z)(_,2),j=N[0],A=N[1],B=function(e,t,n){F(t),A(n)},G=o().useState(""),V=(0,r.Z)(G,2),L=V[0],z=V[1],M=D.length>0||L,H=t.map((function(e){return e.display_name})),U=g.filter((function(e){return!(D.length>0)||e.applications.find((function(e){return D.includes(e)}))})).filter((function(e){return e.name.toLowerCase().includes(L)})).filter((function(e){return!l||H.includes(e.display_name)})),X=o().useState(1),Q=(0,r.Z)(X,2),Y=Q[0],W=Q[1],$=o().useState(10),J=(0,r.Z)($,2),K=J[0],ee=J[1],te=function(e){var t=e.id;return o().createElement(c.Pagination,{itemCount:U.length,perPage:K,page:Y,onSetPage:function(e,t){return W(t)},id:"access-requests-roles-table-pagination-".concat(t),variant:t,onPerPageSelect:function(e,t){W(1),ee(t)},isCompact:"top"===t})};te.propTypes={id:p().string};var ne=U.sort((function(e,t){return"number"==typeof e[R]?"asc"===j?e[R]-t[R]:t[R]-e[R]:"asc"===j?(e[R]+"").localeCompare(t[R]):(t[R]+"").localeCompare(e[R])})).slice((Y-1)*K,Y*K),ae=!!(t.length>0)&&null,re=t.length===U.length&&t.length>0||ae,le=function(e,a,r){var l=ne[r].display_name;n(a?t.concat(l):t.filter((function(e){return e!==l})))},oe=o().createElement(c.Button,{variant:"link",onClick:function(){O([]),z("")}},"Clear filters"),ce=l?null:o().createElement(w,{selectedRoles:t,setSelectedRoles:n,isChecked:re,appSelections:D,setAppSelections:O,columns:d,rows:g,filteredRows:U,pagedRows:ne,clearFiltersButton:oe,perPage:K,nameFilter:L,setNameFilter:z,AccessRequestsPagination:te,applications:S}),ie=["Application","Resource type","Operation"],se=(0,u.I0)(),ue=o().createElement(i.TableComposable,{"aria-label":"My user access roles",variant:"compact"},o().createElement(i.Thead,null,o().createElement(i.Tr,null,!l&&o().createElement(i.Th,null),o().createElement(i.Th,{width:30,sort:{sortBy:{index:R,direction:j},onSort:B,columnIndex:"name"}},d[0]),o().createElement(i.Th,{width:50,sort:{sortBy:{index:R,direction:j},onSort:B,columnIndex:"description"}},d[1]),o().createElement(i.Th,{width:10,sort:{sortBy:{index:R,direction:j},onSort:B,columnIndex:"permissions"},modifier:"nowrap"},d[2]))),0===g.length&&(0,a.Z)(Array(K).keys()).map((function(e){return o().createElement(i.Tbody,{key:e},o().createElement(i.Tr,null,!l&&o().createElement(i.Td,null),d.map((function(e,t){return o().createElement(i.Td,{dataLabel:e,key:t},o().createElement("div",{style:{height:"22px"},className:"ins-c-skeleton ins-c-skeleton__md"}," "))}))))})),ne.map((function(e,n){return o().createElement(i.Tbody,{key:n},o().createElement(i.Tr,null,!l&&o().createElement(i.Td,{select:{rowIndex:n,onSelect:le,isSelected:t.find((function(t){return t===e.display_name}))}}),o().createElement(i.Td,{dataLabel:d[0]},e.display_name),o().createElement(i.Td,{dataLabel:d[1],className:"pf-m-truncate"},o().createElement(c.Tooltip,{entryDelay:1e3,content:e.description},o().createElement("span",{className:"pf-m-truncate pf-c-table__text"},e.description))),o().createElement(i.Td,{dataLabel:d[2],className:(0,s.i)("pf-c-table__compound-expansion-toggle",e.isExpanded&&"pf-m-expanded")},o().createElement("button",{type:"button",className:"pf-c-table__button",onClick:function(){return function(e){e.isExpanded=!e.isExpanded,v((0,a.Z)(g)),e.access||f.Z.get("".concat("/api/rbac/v1","/roles/").concat(e.uuid,"/"),{headers:{Accept:"application/json"}}).then((function(t){e.access=t.access.map((function(e){return e.permission.split(":")})),v((0,a.Z)(g))})).catch((function(t){return se((0,m.wN)({variant:"danger",title:"Could not fetch permission list for ".concat(e.name,"."),description:t.message}))}))}(e)}},e.permissions))),o().createElement(i.Tr,{isExpanded:e.isExpanded},!l&&o().createElement(i.Td,null),o().createElement(i.Td,{className:"pf-u-p-0",colSpan:3},o().createElement(i.TableComposable,{className:"pf-m-no-border-rows"},o().createElement(i.Thead,null,o().createElement(i.Tr,null,ie.map((function(e){return o().createElement(i.Th,{key:e},e)})))),o().createElement(i.Tbody,null,Array.isArray(e.access)?e.access.map((function(e){return o().createElement(i.Tr,{key:e.join(":")},o().createElement(i.Td,{dataLabel:ie[0]},e[0]),o().createElement(i.Td,{dataLabel:ie[1]},e[1]),o().createElement(i.Td,{dataLabel:ie[2]},e[2]))})):(0,a.Z)(Array(e.permissions).keys()).map((function(e){return o().createElement(i.Tr,{key:e},ie.map((function(e){return o().createElement(i.Td,{key:e,dataLabel:e},o().createElement("div",{style:{height:"22px"},className:"ins-c-skeleton ins-c-skeleton__sm"}," "))})))})))))))})),0===ne.length&&M?o().createElement(I,{columns:d,clearFiltersButton:oe}):null);return o().createElement(o().Fragment,null,!l&&o().createElement(o().Fragment,null,o().createElement(c.Title,{headingLevel:"h2"},"Select roles"),o().createElement("p",null,"Select the roles you would like access to.")),ce,ue,l&&o().createElement(te,{id:"bottom"}))};D.propTypes={roles:p().any,setRoles:p().any};const O=D},24874:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var a=n(96992),r=n.n(a),l=n(33366),o=n(1140),c=n(85118),i=r().create();i.interceptors.request.use(l.w5),i.interceptors.response.use(l.xH),i.interceptors.response.use(null,l.Di),i.interceptors.response.use(null,(function(e){var t=o.Z.getStore();throw e.response&&403===e.response.status&&t.dispatch({type:c.j,payload:403}),e})),i.interceptors.response.use(null,l.ub),i.interceptors.response.use(null,l.ud);const s=i},42027:(e,t,n)=>{"use strict";n.d(t,{m:()=>E,p:()=>y});var a=n(29439),r=n(92950),l=n.n(r),o=n(6848),c=n(28216),i=n(83215),s=n(76710),u=n(73755),m=n(80164),d=n(45697),p=n.n(d),f=n(24874);function E(e,t,n){var a=[];return"pending"===e&&(a.push({title:"Edit",onClick:function(){return n({type:"edit",requestId:t})}}),a.push({title:"Cancel",onClick:function(){return n({type:"cancel",requestId:t})}})),{items:a,disable:0===a.length}}function y(e){var t=e.requestId,n=e.status,r=e.hideActions,d=l().useState(n),p=(0,a.Z)(d,2),E=p[0],y=p[1],g=l().useState(!1),v=(0,a.Z)(g,2),h=v[0],b=v[1],S=l().useState(!1),T=(0,a.Z)(S,2),w=T[0],k=T[1],C=(0,c.I0)();function I(e){k(!0),f.Z.patch("".concat("/api/rbac/v1","/cross-account-requests/").concat(t,"/"),{status:e},{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(t){if(t.errors&&t.errors.length>0)throw Error(t.errors.map((function(e){return e.detail})).join("\n"));C((0,i.wN)({variant:"success",title:"Request ".concat(e," successfully")})),y(e),b(!1),k(!1)})).catch((function(t){C((0,i.wN)({variant:"danger",title:"There was an error ".concat("approved"===e?"approving":"denying"," your request"),description:t.message})),k(!1)}))}var Z=l().createElement(o.Label,(0,s.Q)(E),(0,m.kC)(E));return r?Z:l().createElement(l().Fragment,null,h||"pending"===E?l().createElement(l().Fragment,null,l().createElement(o.Button,{className:"pf-u-mr-md",isDisabled:w||"approved"===E,variant:"primary",onClick:function(){return I("approved")}},"Approve"),l().createElement(o.Button,{className:"pf-u-mr-md",isDisabled:w||"denied"===E,variant:"danger",onClick:function(){return I("denied")}},"Deny")):Z,["approved","denied"].includes(E)&&l().createElement(o.Button,{variant:"plain","aria-label":"Edit status",onClick:function(){return b(!h)}},l().createElement(u.ZP,null)))}y.propTypes={requestId:p().string,status:p().any,hideActions:p().any}},76710:(e,t,n)=>{"use strict";n.d(t,{Q:()=>u});var a=n(92950),r=n.n(a),l=n(35451),o=n(84564),c=n(3235),i=n(18802),s=n(75427);function u(e){var t=null,n=null;return"pending"===e?(t="blue",n=r().createElement(i.ZP,null)):"approved"===e?(t="green",n=r().createElement(l.ZP,null)):"denied"===e?(t="red",n=r().createElement(o.ZP,null)):"cancelled"===e?(t="orange",n=r().createElement(c.ZP,null)):"expired"===e&&(t="grey",n=r().createElement(s.ZP,null)),{color:t,icon:n}}},97890:()=>{},44370:()=>{},17657:()=>{},22972:()=>{},70347:()=>{},10497:()=>{},32857:()=>{},93818:()=>{},94498:()=>{},54476:()=>{},28992:()=>{},80897:()=>{},40837:()=>{},90479:()=>{},78752:()=>{},74282:()=>{},98379:()=>{},25238:()=>{},1508:()=>{},91993:()=>{},99624:()=>{},36974:()=>{},27479:()=>{},93661:()=>{},56024:()=>{},43390:()=>{},22143:()=>{},314:()=>{},40209:()=>{},87234:()=>{},38299:()=>{},72816:()=>{}}]);
//# sourceMappingURL=../sourcemaps/289.e5c785aa051c07b37f430a162f8915b7.js.map